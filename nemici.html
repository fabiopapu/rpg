<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabella Ferite - PG vs Nemico</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            width: 95%;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            overflow-x: auto;
        }
        .tabella-ferite {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #333;
            color: white;
        }
        input, select {
            width: 80%;
            padding: 4px;
            text-align: center;
        }
        .stato-ferita {
            font-weight: bold;
            color: red;
        }
        .button {
            padding: 10px 15px;
            margin-top: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Tabella Ferite - PG vs Nemico</h2>
    <div id="tabellaContainer"></div>
    
    <button class="button" onclick="salvaDatiLocalStorage()">Salva Dati</button>
    <button class="button" onclick="scaricaBackup()">Scarica Backup</button>
    <input type="file" class="button" onchange="caricaBackup(event)" />
</div>

<script>
function creaTabelleFerite() {
    const container = document.getElementById("tabellaContainer");
    for (let i = 0; i < 12; i++) {
        const tabella = document.createElement("table");
        tabella.className = "tabella-ferite";
        tabella.innerHTML = `
            <thead>
                <tr>
                    <th colspan="5">PG</th>
                    <th colspan="5">Nemico</th>
                </tr>
                <tr>
                    <th>Nome PG</th>
                    <th>Protezione</th>
                    <th>Indice Ferite</th>
                    <th>Danni Subiti</th>
                    <th>Stato Ferita</th>
                    <th>Nome Nemico</th>
                    <th>Protezione</th>
                    <th>Indice Ferite</th>
                    <th>Danni Subiti</th>
                    <th>Stato Ferita</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" id="nomePG${i}" placeholder="Nome PG"></td>
                    <td>
                        <select id="protezionePG${i}">
                            <option value="+1">+1</option>
                            <option value="+2">+2</option>
                            <option value="+3">+3</option>
                        </select>
                    </td>
                    <td><input type="number" id="indiceFeritePG${i}" min="1" max="20" value="2" onchange="calcolaStatoPG(${i})"></td>
                    <td><input type="number" id="danniSubitiPG${i}" min="0" value="0" onchange="calcolaStatoPG(${i})"></td>
                    <td class="stato-ferita" id="statoFeritaPG${i}">Lieve</td>

                    <td><input type="text" id="nomeNemico${i}" placeholder="Nome Nemico"></td>
                    <td>
                        <select id="protezioneNemico${i}">
                            <option value="+1">+1</option>
                            <option value="+2">+2</option>
                            <option value="+3">+3</option>
                        </select>
                    </td>
                    <td><input type="number" id="indiceFeriteNemico${i}" min="1" max="20" value="2" onchange="calcolaStatoNemico(${i})"></td>
                    <td><input type="number" id="danniSubitiNemico${i}" min="0" value="0" onchange="calcolaStatoNemico(${i})"></td>
                    <td class="stato-ferita" id="statoFeritaNemico${i}">Lieve</td>
                </tr>
            </tbody>
        `;
        container.appendChild(tabella);
    }
    ripristinaDatiLocalStorage();
}

// Calcolo stati PG
function calcolaStatoPG(id) {
    const indice = parseInt(document.getElementById(`indiceFeritePG${id}`).value,10) || 1;
    const danni = parseInt(document.getElementById(`danniSubitiPG${id}`).value,10) || 0;
    const stati = ["Lieve","Media","Intensa","Profonda","Critica","Grave","Morte"];
    let livello = Math.floor((danni-1)/indice);
    livello = Math.max(0, Math.min(livello, stati.length-1));
    document.getElementById(`statoFeritaPG${id}`).innerText = stati[livello];
    salvaDatiLocalStorage();
}

// Calcolo stati Nemico
function calcolaStatoNemico(id) {
    const indice = parseInt(document.getElementById(`indiceFeriteNemico${id}`).value,10) || 1;
    const danni = parseInt(document.getElementById(`danniSubitiNemico${id}`).value,10) || 0;
    const stati = ["Lieve","Media","Intensa","Profonda","Critica","Grave","Morte"];
    let livello = Math.floor((danni-1)/indice);
    livello = Math.max(0, Math.min(livello, stati.length-1));
    document.getElementById(`statoFeritaNemico${id}`).innerText = stati[livello];
    salvaDatiLocalStorage();
}

// Salvataggio
function salvaDatiLocalStorage() {
    const dati = [];
    for(let i=0;i<12;i++){
        dati.push({
            nomePG: document.getElementById(`nomePG${i}`).value,
            protezionePG: document.getElementById(`protezionePG${i}`).value,
            indicePG: document.getElementById(`indiceFeritePG${i}`).value,
            danniPG: document.getElementById(`danniSubitiPG${i}`).value,
            statoPG: document.getElementById(`statoFeritaPG${i}`).innerText,

            nomeNemico: document.getElementById(`nomeNemico${i}`).value,
            protezioneNemico: document.getElementById(`protezioneNemico${i}`).value,
            indiceNemico: document.getElementById(`indiceFeriteNemico${i}`).value,
            danniNemico: document.getElementById(`danniSubitiNemico${i}`).value,
            statoNemico: document.getElementById(`statoFeritaNemico${i}`).innerText
        });
    }
    localStorage.setItem("datiFerite", JSON.stringify(dati));
}

// Ripristino
function ripristinaDatiLocalStorage(){
    const datiSalvati = JSON.parse(localStorage.getItem("datiFerite"));
    if(datiSalvati){
        datiSalvati.forEach((dati,i)=>{
            document.getElementById(`nomePG${i}`).value=dati.nomePG;
            document.getElementById(`protezionePG${i}`).value=dati.protezionePG || "+1";
            document.getElementById(`indiceFeritePG${i}`).value=dati.indicePG;
            document.getElementById(`danniSubitiPG${i}`).value=dati.danniPG;
            document.getElementById(`statoFeritaPG${i}`).innerText=dati.statoPG;

            document.getElementById(`nomeNemico${i}`).value=dati.nomeNemico;
            document.getElementById(`protezioneNemico${i}`).value=dati.protezioneNemico || "+1";
            document.getElementById(`indiceFeriteNemico${i}`).value=dati.indiceNemico;
            document.getElementById(`danniSubitiNemico${i}`).value=dati.danniNemico;
            document.getElementById(`statoFeritaNemico${i}`).innerText=dati.statoNemico;
        });
    }
}

// Backup
function scaricaBackup(){
    const datiBackup = localStorage.getItem("datiFerite");
    if(datiBackup){
        const blob = new Blob([datiBackup],{type:"application/json"});
        const link=document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "backup_ferite.json";
        link.click();
    } else alert("Nessun dato salvato per il backup.");
}

function caricaBackup(event){
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload=function(e){
        const datiBackup = JSON.parse(e.target.result);
        if(datiBackup){
            datiBackup.forEach((dati,i)=>{
                document.getElementById(`nomePG${i}`).value=dati.nomePG;
                document.getElementById(`protezionePG${i}`).value=dati.protezionePG || "+1";
                document.getElementById(`indiceFeritePG${i}`).value=dati.indicePG;
                document.getElementById(`danniSubitiPG${i}`).value=dati.danniPG;
                document.getElementById(`statoFeritaPG${i}`).innerText=dati.statoPG;

                document.getElementById(`nomeNemico${i}`).value=dati.nomeNemico;
                document.getElementById(`protezioneNemico${i}`).value=dati.protezioneNemico || "+1";
                document.getElementById(`indiceFeriteNemico${i}`).value=dati.indiceNemico;
                document.getElementById(`danniSubitiNemico${i}`).value=dati.danniNemico;
                document.getElementById(`statoFeritaNemico${i}`).innerText=dati.statoNemico;
            });
            alert("Backup caricato con successo.");
            salvaDatiLocalStorage();
        } else alert("Errore nel caricare il file. Assicurati che sia JSON valido.");
    };
    reader.readAsText(file);
}

window.onload = creaTabelleFerite;
</script>

</body>
</html>
